# Go 高性能微服务网关

## 项目概述

本项目是基于 **Go 语言** 构建的高性能微服务网关，旨在为微服务架构提供统一的入口管理与全链路流量治理能力。通过整合服务注册发现、路由转发、负载均衡、认证授权等核心功能，解决微服务架构下服务管理复杂、流量管控困难、协议不兼容等痛点，助力企业快速搭建稳定、高效、可扩展的微服务体系。

网关采用轻量级设计，依托 Go 语言的高并发特性与低资源消耗优势，支持每秒数万级请求处理，同时提供灵活的配置机制与完善的监控告警能力，满足从中小规模到大型分布式系统的流量治理需求。

## 核心功能

### 1. 服务注册与发现



* 支持与主流服务注册中心集成（如 Etcd、Consul、Nacos），自动发现集群内可用服务实例

* 实时感知服务上下线状态，动态更新服务列表，避免请求发送至不可用节点

* 支持服务健康检查（HTTP/GRPC/TCP 协议），自动剔除异常实例，保障服务可用性

### 2. 智能请求路由转发



* 基于 **路径匹配**、**服务名称**、**请求头**、**参数** 等多维度路由规则，精准转发请求

* 支持路由优先级配置，解决规则冲突场景

* 内置路由缓存机制，减少规则匹配耗时，提升转发效率

* 支持路由动态更新（无需重启网关），适应业务频繁变更需求

### 3. 多策略负载均衡

提供三种核心负载均衡策略，满足不同业务场景需求：



* **轮询（Round Robin）**：默认策略，按顺序均匀分配请求至服务实例，适用于实例性能一致场景

* **权重（Weighted）**：根据实例权重分配请求（权重可配置），支持对高性能实例分配更多流量

* **一致性哈希（Consistent Hash）**：基于请求标识（如 IP、用户 ID）哈希路由，保障同一请求者始终访问同一实例，减少会话丢失风险

### 4. 全方位认证授权



* **JWT 认证**：支持解析 JWT Token，验证 Token 有效性、过期时间，提取用户身份信息

* **API 密钥认证**：支持通过请求头 / 参数传递 API Key，校验密钥合法性，实现接口访问控制

* **自定义认证扩展**：提供认证插件接口，支持集成 OAuth2.0、LDAP 等第三方认证体系

* 基于角色的权限控制（RBAC）：支持按服务、路径配置访问权限，拒绝未授权请求

### 5. 精细化流量控制



* **限流（Rate Limiting）**：支持基于 QPS、并发数、IP、用户 ID 等维度限流，防止服务被突发流量击垮

* **熔断（Circuit Breaking）**：当服务错误率 / 响应时间超过阈值时，自动触发熔断，快速返回降级响应，避免级联故障

* **降级（Degradation）**：支持配置降级策略（如返回默认值、缓存数据），在服务不可用时保障核心业务可用

* 流量控制规则支持动态调整，无需重启网关

### 6. 多协议转换



* 支持 **HTTP ↔ gRPC** 协议转换：接收 HTTP 请求，转发为 gRPC 请求至后端服务，同时将 gRPC 响应转换为 HTTP 响应返回

* 支持 **JSON ↔ Protobuf** 格式转换：自动处理请求 / 响应数据格式转换，降低前后端 / 服务间协议适配成本

* 支持 HTTP 1.1/2 协议，可配置启用 HTTPS（自动证书管理可选）

### 7. 请求过滤与改写



* **请求过滤**：支持按请求头、参数、IP 等条件过滤请求，直接拦截非法请求（如恶意参数、黑名单 IP）

* **请求改写**：支持修改请求路径、请求头、参数（如添加统一请求 ID、补充默认参数）

* **响应改写**：支持修改响应状态码、响应头、响应体（如统一错误格式、敏感信息脱敏）

### 8. 监控告警与日志



* **Metrics 监控**：内置 Prometheus 指标暴露接口，支持采集请求量、响应时间、错误率、限流次数、熔断状态等核心指标

* **日志收集**：支持按请求维度输出详细日志（包含请求 ID、路由信息、响应时间、错误详情），支持对接 ELK、Grafana Loki 等日志系统

* **告警机制**：支持配置指标阈值告警（如错误率超过 5%、限流次数突增），对接邮件、钉钉、Slack 等告警渠道

* 内置 Dashboard（可选集成 Grafana），可视化展示网关运行状态与流量趋势

### 9. 灰度发布与 A/B 测试



* 支持基于 **权重**、**用户白名单**、**请求参数** 等维度拆分流量，实现灰度发布（如将 10% 流量路由至新版本服务）

* 支持多版本服务并行部署，通过路由规则实现 A/B 测试，对比不同版本业务指标（如转化率、响应时间）

* 灰度规则支持动态调整，可随时扩大 / 缩小灰度范围，降低新版本上线风险

## 快速开始

### 1. 环境要求



* Go 1.20+（推荐 1.21+）

* 服务注册中心（如 Etcd 3.5+、Consul 1.15+，可选）

* Prometheus/Grafana（可选，用于监控）

### 2. 安装与启动

#### 方式 1：源码编译



```
\# 克隆代码仓库

git clone https://github.com/your-org/your-gateway.git

cd your-gateway

\# 编译项目

go build -o gateway ./cmd/gateway

\# 启动网关（使用默认配置）

./gateway --config ./configs/default.yaml
```

#### 方式 2：Docker 启动



```
\# 拉取镜像（假设已上传至 Docker Hub）

docker pull your-org/your-gateway:latest

\# 启动容器

docker run -d -p 8080:8080 -v ./configs:/app/configs your-org/your-gateway:latest
```

### 3. 简单使用示例

#### 配置路由规则

在 `configs/default.yaml` 中添加路由配置：



```
routes:

&#x20; \- name: user-service-route

&#x20;   path: /api/v1/users/\*\*

&#x20;   service: user-service  # 对应服务注册中心的服务名

&#x20;   loadBalancer:

&#x20;     type: weighted  # 权重负载均衡

&#x20;     weights:

&#x20;       10.0.0.101: 5  # 实例 10.0.0.101 权重 5

&#x20;       10.0.0.102: 3  # 实例 10.0.0.102 权重 3

&#x20;   auth:

&#x20;     type: apiKey  # 使用 API Key 认证

&#x20;     apiKey:

&#x20;       header: X-API-Key

&#x20;       validKeys: \["your-valid-api-key-1", "your-valid-api-key-2"]
```

#### 测试路由转发



```
\# 发送请求至网关，自动转发至 user-service

curl -H "X-API-Key: your-valid-api-key-1" http://localhost:8080/api/v1/users/1
```

## 详细配置说明

完整配置文档请参考 [CONFIG.md](./CONFIG.md)，包含以下模块的详细配置指南：



* 服务注册中心配置（Etcd/Consul/Nacos）

* 路由规则与负载均衡配置

* 认证授权（JWT/API Key）配置

* 限流、熔断、降级配置

* 协议转换与请求改写配置

* 监控日志与告警配置

* 灰度发布规则配置

## 扩展开发

网关提供丰富的插件接口，支持自定义扩展：



* **认证插件**：实现 `auth.AuthInterface` 接口，集成自定义认证逻辑

* **负载均衡插件**：实现 `loadbalance.BalancerInterface` 接口，添加自定义负载均衡策略

* **流量控制插件**：实现 `flowcontrol.ControlInterface` 接口，扩展限流 / 熔断逻辑

* **中间件扩展**：支持添加自定义 HTTP 中间件，处理请求 / 响应生命周期

扩展开发示例请参考 [EXTEND.md](./EXTEND.md)。

## 性能指标

在 4C8G 服务器环境下，默认配置的性能测试结果（基于 JMeter 压测）：



* 单节点 QPS：≥ 30000（HTTP 协议，简单路由转发场景）

* 平均响应时间：≤ 10ms（正常流量下）

* 资源占用：CPU ≤ 30%，内存 ≤ 500MB（QPS=20000 时）

## 贡献指南

欢迎参与项目贡献！无论是 Bug 修复、功能新增，还是文档完善，都可以通过以下方式参与：



1. Fork 本仓库

2. 创建特性分支（`git checkout -b feature/your-feature`）

3. 提交代码（`git commit -m "feat: add your feature"`）

4. 推送分支（`git push origin feature/your-feature`）

5. 提交 Pull Request

贡献规范请参考 [CONTRIBUTING.md](./CONTRIBUTING.md)。

## 许可证

本项目基于 **MIT 许可证** 开源，详情请查看 [LICENSE](./LICENSE) 文件。


